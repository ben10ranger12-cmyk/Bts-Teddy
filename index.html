<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ðŸ’œ BTS Neon Claw Machine ðŸ’œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: radial-gradient(circle at center, #2a0a4a 0%, #150025 100%);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: relative;
            touch-action: none;
        }

        /* Animated Nebula Background */
        .stars {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            background-image: 
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 2px),
                radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 3px);
            background-size: 550px 550px, 350px 350px, 250px 250px;
            background-position: 0 0, 40px 60px, 130px 270px;
            animation: starMove 60s linear infinite;
        }

        @keyframes starMove {
            from { transform: translateY(0); }
            to { transform: translateY(-550px); }
        }

        /* Game Layout */
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding-bottom: 80px; 
        }

        /* Neon Title */
        #title {
            position: absolute;
            top: 5vh;
            text-align: center;
            z-index: 10;
            width: 100%;
            pointer-events: none;
        }

        #title h1 {
            font-size: clamp(24px, 5vw, 45px);
            color: #fff;
            text-shadow: 
                0 0 5px #fff,
                0 0 10px #fff,
                0 0 20px #bc13fe,
                0 0 40px #bc13fe;
            font-weight: 800;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        #title p {
            font-size: clamp(10px, 2.5vw, 14px);
            color: #E0AAFF;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        /* Mute Button */
        #mute-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 50;
            background: rgba(255,255,255,0.1);
            border: 1px solid #E0AAFF;
            color: #E0AAFF;
            width: 40px; height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Canvas */
        #game-canvas {
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            box-shadow: 
                0 0 30px rgba(188, 19, 254, 0.4),
                inset 0 0 50px rgba(0, 0, 0, 0.8);
            background: rgba(20, 0, 40, 0.6);
            backdrop-filter: blur(5px);
            width: 90vw;
            max-width: 500px;
            height: 60vh;
            max-height: 600px;
            display: block;
        }

        /* Controls */
        #controls {
            position: absolute;
            bottom: 5vh;
            display: flex;
            gap: 20px;
            align-items: center;
            z-index: 20;
            width: 100%;
            justify-content: center;
        }

        .arrow-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #E0AAFF;
            color: #E0AAFF;
            width: 65px; height: 65px;
            font-size: 24px;
            border-radius: 50%;
            cursor: pointer;
            backdrop-filter: blur(4px);
            transition: all 0.2s ease;
            box-shadow: 0 0 15px rgba(224, 170, 255, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
        }

        .arrow-btn:active, .arrow-btn.active-press {
            background: #E0AAFF;
            color: #2a0a4a;
            transform: scale(0.95);
        }

        #play-btn {
            background: linear-gradient(135deg, #bc13fe, #7a0cd4);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 
                0 0 20px rgba(188, 19, 254, 0.6),
                inset 0 2px 0 rgba(255, 255, 255, 0.4);
            transition: transform 0.2s;
            text-transform: uppercase;
            letter-spacing: 2px;
            white-space: nowrap;
        }

        #play-btn:active { transform: scale(0.95); }
        #play-btn:disabled, .arrow-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        /* Popup */
        #message-popup {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(30, 10, 50, 0.95);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8), 0 0 30px rgba(188, 19, 254, 0.3);
            text-align: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 85%;
            max-width: 350px;
        }

        #message-popup.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            pointer-events: all;
        }

        .popup-glow-bg {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 150px; height: 150px;
            background: radial-gradient(circle, rgba(188,19,254,0.4) 0%, transparent 70%);
            z-index: -1;
        }

        #message-popup .member-icon {
            font-size: 60px;
            margin-bottom: 15px;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        #message-popup h2 {
            color: white; font-size: 24px; margin-bottom: 10px;
        }

        #message-popup p {
            color: #E0AAFF; line-height: 1.5; margin-bottom: 25px; font-size: 15px;
        }

        #close-popup {
            background: white; color: #2a0a4a; border: none;
            padding: 12px 30px; border-radius: 30px; font-weight: bold;
            cursor: pointer; transition: 0.3s;
        }
        #close-popup:hover { background: #E0AAFF; }

        /* Start Screen Overlay (Required for Audio Context) */
        #start-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(20, 0, 40, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.5s;
        }
        
        #start-screen.hidden { opacity: 0; pointer-events: none; }
        
        #start-btn {
            background: transparent;
            border: 2px solid #bc13fe;
            color: white;
            padding: 20px 40px;
            font-size: 24px;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 0 20px #bc13fe;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse { 0% { box-shadow: 0 0 20px #bc13fe; } 50% { box-shadow: 0 0 40px #bc13fe; } 100% { box-shadow: 0 0 20px #bc13fe; } }

        @media (max-height: 500px) and (orientation: landscape) {
            #game-canvas { height: 55vh; }
            #title { top: 10px; }
            #title h1 { font-size: 20px; margin: 0; }
            #title p { display: none; }
            #controls { bottom: 10px; }
            .arrow-btn { width: 45px; height: 45px; font-size: 18px; }
            #play-btn { padding: 10px 30px; font-size: 14px; }
        }

    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="color:white; margin-bottom: 30px;">NEON CLAW</h1>
        <button id="start-btn">TAP TO START</button>
    </div>

    <div class="stars"></div>
    <button id="mute-btn">ðŸ”Š</button>

    <div id="title">
        <h1>NEON CLAW</h1>
        <p>Catch the Members â€¢ Collect OT7</p>
    </div>

    <div id="game-container">
        <canvas id="game-canvas"></canvas>
    </div>

    <div id="controls">
        <button class="arrow-btn" id="left-btn">â—€</button>
        <button id="play-btn">GRAB</button>
        <button class="arrow-btn" id="right-btn">â–¶</button>
    </div>

    <div id="message-popup">
        <div class="popup-glow-bg"></div>
        <div class="member-icon">âœ¨</div>
        <h2 id="popup-title">Gotcha!</h2>
        <p id="popup-message">Message here...</p>
        <button id="close-popup">Collect ðŸ’œ</button>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        // ========================
        // SOUND ENGINE (Web Audio API)
        // ========================
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let isMuted = false;
        let motorOsc = null; // Reference to motor sound

        const Sound = {
            playTone: (freq, type, duration, vol = 0.1) => {
                if(isMuted || audioCtx.state === 'suspended') return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                gain.gain.setValueAtTime(vol, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + duration);
            },
            
            startMotor: () => {
                if(isMuted || motorOsc || audioCtx.state === 'suspended') return;
                motorOsc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                motorOsc.type = 'sawtooth';
                motorOsc.frequency.setValueAtTime(80, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.03, audioCtx.currentTime);
                motorOsc.connect(gain);
                gain.connect(audioCtx.destination);
                motorOsc.start();
            },

            stopMotor: () => {
                if(motorOsc) {
                    motorOsc.stop();
                    motorOsc = null;
                }
            },

            playDrop: () => {
                if(isMuted) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.5);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            },

            playWin: () => {
                if(isMuted) return;
                // Simple Arpeggio C Major
                [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
                    setTimeout(() => Sound.playTone(freq, 'sine', 0.3, 0.1), i * 150);
                });
            },

            playLose: () => {
                if(isMuted) return;
                // Sad descending tones
                setTimeout(() => Sound.playTone(300, 'triangle', 0.3, 0.1), 0);
                setTimeout(() => Sound.playTone(250, 'triangle', 0.3, 0.1), 300);
                setTimeout(() => Sound.playTone(200, 'triangle', 0.6, 0.1), 600);
            },

            playPopup: () => {
                if(isMuted) return;
                Sound.playTone(1200, 'sine', 0.5, 0.05);
            }
        };

        // ========================
        // GAME DATA
        // ========================
        const btsMembers = [
            { name: 'RM', color: '#64C7FF', hair: '#A6E3FF', icon: 'ðŸ¨', msg: 'You are the leader of my heart! ðŸ’™' },
            { name: 'Jin', color: '#FF99C8', hair: '#4A235A', icon: 'ðŸ¹', msg: 'Worldwide Handsome catch! ðŸ’–' },
            { name: 'Suga', color: '#333333', hair: '#1A1A1A', icon: 'ðŸ±', msg: 'A quiet melody just for you. ðŸŽ¹' },
            { name: 'J-Hope', color: '#FF5400', hair: '#FF9E00', icon: 'ðŸ¿ï¸', msg: 'I\'m your hope, you\'re my hope! â˜€ï¸' },
            { name: 'Jimin', color: '#FFD700', hair: '#FFEEA5', icon: 'ðŸ¥', msg: 'You are my serendipity. ðŸ’›' },
            { name: 'V', color: '#8A2BE2', hair: '#483D8B', icon: 'ðŸ¯', msg: 'I Purple You forever! ðŸ’œ' },
            { name: 'JK', color: '#9B59B6', hair: '#000000', icon: 'ðŸ°', msg: 'Let\'s stay young forever. ðŸŽ¶' }
        ];

        let state = {
            toys: [], collected: [], 
            claw: { x: 0, y: 50, width: 60, height: 40, open: true },
            isPlaying: false, heldToy: null, 
            logicalWidth: 0, logicalHeight: 0
        };

        // ========================
        // SETUP & RESIZE
        // ========================
        function init() {
            resize();
            spawnToys();
            animate();
        }

        function resize() {
            const rect = canvas.getBoundingClientRect();
            state.logicalWidth = rect.width;
            state.logicalHeight = rect.height;
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            state.claw.x = state.logicalWidth / 2;
        }

        function spawnToys() {
            state.toys = [];
            state.collected = [];
            const startX = 110;
            const availableWidth = state.logicalWidth - startX - 40;

            btsMembers.forEach((member, i) => {
                state.toys.push({
                    ...member,
                    x: startX + Math.random() * availableWidth,
                    y: state.logicalHeight - 60 - (Math.random() * 20),
                    rotation: (Math.random() - 0.5) * 0.5,
                    id: i
                });
            });
        }

        // ========================
        // DRAWING
        // ========================
        function draw() {
            ctx.clearRect(0, 0, state.logicalWidth, state.logicalHeight);
            drawChute();
            state.toys.forEach(toy => { if (toy !== state.heldToy) drawToy(toy); });

            if (state.heldToy) {
                state.heldToy.x = state.claw.x;
                state.heldToy.y = state.claw.y + 40; 
                drawToy(state.heldToy);
            }

            drawClawLine();
            drawClawHead();
            drawGlassReflection();
        }

        function drawChute() {
            ctx.fillStyle = '#1a0b2e';
            ctx.fillRect(0, state.logicalHeight - 120, 90, 120);
            ctx.strokeStyle = '#bc13fe';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, state.logicalHeight - 120, 90, 120);
            ctx.fillStyle = '#E0AAFF';
            ctx.font = '10px Arial';
            ctx.fillText("PRIZE DROP", 15, state.logicalHeight - 100);
        }

        function drawClawLine() {
            ctx.beginPath();
            ctx.moveTo(state.claw.x, 0);
            ctx.lineTo(state.claw.x, state.claw.y);
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 4;
            ctx.stroke();
        }

        function drawClawHead() {
            const { x, y, width, height, open } = state.claw;
            ctx.save();
            ctx.translate(x, y);
            const grad = ctx.createLinearGradient(-20, 0, 20, 0);
            grad.addColorStop(0, '#555'); grad.addColorStop(1, '#999');
            ctx.fillStyle = grad; ctx.fillRect(-20, -10, 40, 20);
            ctx.strokeStyle = '#ccc'; ctx.lineWidth = 5; ctx.lineCap = 'round';
            
            ctx.beginPath();
            ctx.moveTo(-15, 10);
            ctx.quadraticCurveTo(-width/2 - (open?10:0), height, -10 + (open? -10:5), height + 15);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(15, 10);
            ctx.quadraticCurveTo(width/2 + (open?10:0), height, 10 + (open? 10:-5), height + 15);
            ctx.stroke();
            ctx.restore();
        }

        function drawToy(toy) {
            ctx.save();
            ctx.translate(toy.x, toy.y);
            ctx.rotate(toy.rotation);
            ctx.shadowColor = toy.color; ctx.shadowBlur = 15;
            ctx.fillStyle = toy.color;
            ctx.beginPath();
            if(ctx.roundRect) ctx.roundRect(-15, 0, 30, 35, 8); else ctx.rect(-15, 0, 30, 35);
            ctx.fill();
            ctx.fillStyle = '#FFE0BD'; ctx.beginPath(); ctx.arc(0, -5, 18, 0, Math.PI * 2); ctx.fill();
            ctx.fillStyle = toy.hair; ctx.beginPath(); ctx.arc(0, -8, 20, Math.PI, 0); ctx.fill();
            ctx.fillStyle = 'black'; ctx.shadowBlur = 0; ctx.beginPath();
            ctx.arc(-5, -5, 2, 0, Math.PI * 2); ctx.arc(5, -5, 2, 0, Math.PI * 2); ctx.fill();
            ctx.font = '14px Arial'; ctx.textAlign = 'center'; ctx.fillText(toy.icon, 0, 22);
            ctx.fillStyle = 'white'; ctx.font = 'bold 10px Arial'; ctx.fillText(toy.name, 0, -30);
            ctx.restore();
        }

        function drawGlassReflection() {
            const grad = ctx.createLinearGradient(0, 0, state.logicalWidth, state.logicalHeight);
            grad.addColorStop(0, 'rgba(255,255,255,0.1)');
            grad.addColorStop(0.5, 'transparent');
            grad.addColorStop(1, 'rgba(188,19,254,0.05)');
            ctx.fillStyle = grad;
            ctx.fillRect(0,0, state.logicalWidth, state.logicalHeight);
        }

        function animate() {
            draw();
            requestAnimationFrame(animate);
        }

        function animateValue(object, prop, start, end, duration, easing = true) {
            return new Promise(resolve => {
                const startTime = performance.now();
                function update(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const ease = easing ? (progress < 0.5 ? 2 * progress * progress : 1 - Math.pow(-2 * progress + 2, 2) / 2) : progress;
                    object[prop] = start + (end - start) * ease;
                    if (progress < 1) requestAnimationFrame(update); else resolve();
                }
                requestAnimationFrame(update);
            });
        }

        // ========================
        // GAME LOGIC
        // ========================
        async function runGame() {
            if (state.isPlaying) return;
            if (state.toys.length === 0) {
                alert("You caught everyone! Resetting game...");
                spawnToys();
                return;
            }

            state.isPlaying = true;
            updateButtons(true);

            // 1. Drop
            Sound.playDrop();
            let target = null;
            let minDist = 1000;
            state.toys.forEach(toy => {
                const d = Math.abs(toy.x - state.claw.x);
                if (d < minDist) { minDist = d; target = toy; }
            });

            const isCatch = target && minDist < 35;
            const targetY = isCatch ? target.y - 40 : state.logicalHeight - 80;
            
            await animateValue(state.claw, 'y', 50, targetY, 1000);

            // 2. Grab
            state.claw.open = false; 
            await new Promise(r => setTimeout(r, 300));

            if (isCatch) {
                state.heldToy = target; 
                state.heldToy.rotation = 0; 
            }

            // 3. Lift
            Sound.playDrop(); // Reuse slide sound for up
            await animateValue(state.claw, 'y', targetY, 50, 1000);

            if (state.heldToy) {
                // 4. Move to Chute
                Sound.startMotor();
                await animateValue(state.claw, 'x', state.claw.x, 45, 1000);
                Sound.stopMotor();
                
                // 5. Drop
                state.claw.open = true;
                state.heldToy = null; 
                state.collected.push(target);
                state.toys = state.toys.filter(t => t !== target);

                Sound.playWin();
                showPopup(target);
            } else {
                state.claw.open = true;
                Sound.playLose();
                state.isPlaying = false;
                updateButtons(false);
            }
        }

        function showPopup(member) {
            const popup = document.getElementById('message-popup');
            const title = document.getElementById('popup-title');
            const msg = document.getElementById('popup-message');
            const icon = document.querySelector('.member-icon');
            const btn = document.getElementById('close-popup');

            title.innerText = `You caught ${member.name}!`;
            msg.innerText = member.msg;
            icon.innerText = member.icon;

            if (state.toys.length === 0) btn.innerText = "YAY! OT7 COLLECTED! (Reset)";
            else btn.innerText = "Collect ðŸ’œ";

            Sound.playPopup();
            popup.classList.add('show');
        }

        function moveClaw(dir) {
            if (state.isPlaying) return;
            const speed = 10; 
            if (dir === 'left') state.claw.x = Math.max(50, state.claw.x - speed);
            if (dir === 'right') state.claw.x = Math.min(state.logicalWidth - 50, state.claw.x + speed);
        }

        function updateButtons(disabled) {
            document.getElementById('play-btn').disabled = disabled;
            document.querySelectorAll('.arrow-btn').forEach(b => b.disabled = disabled);
        }

        // ========================
        // INPUT HANDLING
        // ========================
        let holdInterval = null;

        function startMove(dir, btnElement) {
            if(state.isPlaying || holdInterval) return;
            btnElement.classList.add('active-press');
            Sound.startMotor();
            moveClaw(dir); 
            holdInterval = setInterval(() => moveClaw(dir), 50); 
        }

        function stopMove() {
            if(holdInterval) {
                clearInterval(holdInterval);
                holdInterval = null;
                document.querySelectorAll('.arrow-btn').forEach(b => b.classList.remove('active-press'));
                Sound.stopMotor();
            }
        }

        // Sound Toggle
        document.getElementById('mute-btn').addEventListener('click', (e) => {
            isMuted = !isMuted;
            e.target.innerText = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
        });

        // Start Screen (Initialize Audio)
        document.getElementById('start-btn').addEventListener('click', () => {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            document.getElementById('start-screen').classList.add('hidden');
            Sound.playPopup(); // Test sound
        });

        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');

        leftBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); startMove('left', leftBtn); });
        rightBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); startMove('right', rightBtn); });

        window.addEventListener('pointerup', stopMove);
        window.addEventListener('pointercancel', stopMove);

        document.getElementById('play-btn').addEventListener('click', runGame);

        document.getElementById('close-popup').addEventListener('click', () => {
            document.getElementById('message-popup').classList.remove('show');
            state.isPlaying = false;
            updateButtons(false);
            state.claw.open = true;
            if (state.toys.length === 0) { spawnToys(); state.claw.x = state.logicalWidth / 2; }
        });

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                resize();
                if(!state.isPlaying && state.toys.length > 0) spawnToys(); 
            }, 200);
        });

        init();
    </script>
</body>
</html>